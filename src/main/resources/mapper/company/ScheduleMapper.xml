<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.albamen.mapper.company.ScheduleMapper">

    <resultMap id="scheduleMap" type="com.example.albamen.dto.company.ScheduleDTO">
        <id property="sno" column="sno"/>
        <result property="sday" column="sDay"/>
        <result property="tno" column="tno"/>
        <result property="mno" column="mno"/>
        <result property="sstatus" column="sStatus"/>
        <collection property="timeList" resultMap="timeMap"></collection>
        <collection property="memberList" resultMap="memberMap"></collection>
    </resultMap>

    <resultMap id="timeMap" type="com.example.albamen.dto.company.TimeDTO">
        <id property="tno" column="tno"/>
        <result property="tname" column="tname"/>
        <result property="bno" column="bno"/>
        <result property="startTime" column="startTime"/>
        <result property="endTime" column="endTime"/>
        <result property="breakStartTime" column="breakStartTime"/>
        <result property="breakEndTime" column="breakEndTime"/>
    </resultMap>
    <resultMap id="memberMap" type="com.example.albamen.dto.member.MemberDTO">
        <id property="mno" column="mno"/>
        <result property="name" column="name"/>
    </resultMap>

    <insert id="insertSchedule">
        insert into schedule_management(sDay, tno, mno, sStatus)
        values (#{sDay}, #{tno}, #{mno}, #{sStatus})
    </insert>
    <select id="selectScheduleList" resultMap="scheduleMap">
        select sno, sDay, sStatus, s.mno, name, s.tno, tname, ts.bno, startTime, endTime, breakStartTime, breakEndTime
        from schedule_management s
        left join time_schedule ts on s.tno = ts.tno
        left join member m on s.mno = m.mno
        where ts.bno = #{bno} and sDay = #{sDay}
    </select>

    <select id="selectTime" resultMap="timeMap">
        select tno, bno, tname, startTime, endTime, breakStartTime, breakEndTime
        from time_schedule
        where tno = #{tno}
    </select>
    <insert id="insertTime">
        insert into time_schedule(bno, tname, startTime, endTime, breakStartTime, breakEndTime)
        values (#{bno}, #{tname}, #{startTime}, #{endTime}, #{breakStartTime}, #{breakEndTime})
    </insert>
    <update id="updateTime">
        update time_schedule
        set tname = #{tname}, startTime = #{startTime}, endTime = #{endTime}, breakStartTime = #{breakStartTime}, breakEndTime = #{breakEndTime}
    </update>
    
    <delete id="deleteTime">
        delete from time_schedule
        where tno = #{tno}
    </delete>

    <select id="selectTimeList" resultMap="timeMap">
        select tno, tname, bno, startTime, endTime, breakStartTime, breakEndTime
        from time_schedule
        where bno = #{bno}
    </select>

    <select id="selectTSchedule" resultMap="scheduleMap">
        select *
        from time_schedule t, schedule_management s
        where t.tno = s.tno
        and s.mno = #{mno}
        and s.sDay = date(now())
    </select>




</mapper>

